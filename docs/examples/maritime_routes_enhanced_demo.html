<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panama Canal Crisis - Enhanced Maritime Routes Analysis</title>
    
    <!-- Leaflet for geographic visualization -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Leaflet plugins for better route visualization -->
    <script src="https://cdn.jsdelivr.net/npm/leaflet-polylinedecorator@1.6.0/dist/leaflet.polylineDecorator.js"></script>
    
    <!-- Chart.js for analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Bootstrap for styling -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f3460 0%, #16537e 100%);
            margin: 0;
            padding: 15px;
        }
        
        .demo-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            overflow: hidden;
            max-width: 1800px;
            margin: 0 auto;
        }
        
        .demo-header {
            background: linear-gradient(135deg, #c62d42 0%, #8b0000 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .crisis-banner {
            background: linear-gradient(45deg, #ff4757 0%, #ff3742 50%, #ff4757 100%);
            color: white;
            padding: 18px;
            text-align: center;
            border-bottom: 4px solid #c0392b;
            animation: criticalPulse 3s infinite;
            position: relative;
            overflow: hidden;
        }
        
        .crisis-banner::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: sweep 2s infinite;
        }
        
        @keyframes criticalPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.85; }
        }
        
        @keyframes sweep {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .main-layout {
            display: grid;
            grid-template-columns: 1fr 450px;
            gap: 0;
            height: 900px;
        }
        
        .map-section {
            position: relative;
            background: #e8f4fd;
        }
        
        #maritime-map {
            width: 100%;
            height: 100%;
        }
        
        .route-info-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.96);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            z-index: 1000;
            min-width: 280px;
            backdrop-filter: blur(10px);
        }
        
        .route-legend h6 {
            margin-bottom: 15px;
            color: #2c3e50;
            font-weight: 600;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            padding: 8px;
            border-radius: 6px;
            transition: background-color 0.2s ease;
        }
        
        .legend-item:hover {
            background-color: rgba(52, 152, 219, 0.1);
        }
        
        .legend-line {
            width: 25px;
            height: 4px;
            margin-right: 12px;
            border-radius: 2px;
            position: relative;
        }
        
        .legend-line.animated::after {
            content: '';
            position: absolute;
            top: -1px;
            left: -2px;
            right: -2px;
            bottom: -1px;
            background: inherit;
            border-radius: 2px;
            animation: routePulse 2s infinite;
        }
        
        @keyframes routePulse {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.1); }
        }
        
        .analytics-sidebar {
            background: #f8f9fa;
            border-left: 1px solid #dee2e6;
            padding: 25px;
            overflow-y: auto;
        }
        
        .impact-alert {
            background: linear-gradient(135deg, #fff1f1 0%, #ffe6e6 100%);
            border: 2px solid #ff6b6b;
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 25px;
            position: relative;
        }
        
        .impact-alert::before {
            content: '🚨';
            position: absolute;
            top: -10px;
            left: 15px;
            background: white;
            padding: 5px 8px;
            border-radius: 50%;
            font-size: 1.2rem;
        }
        
        .metric-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 18px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border-left: 5px solid #007bff;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }
        
        .metric-card.critical {
            border-left-color: #dc3545;
            background: linear-gradient(135deg, #fff8f8 0%, #ffffff 100%);
        }
        
        .metric-card.warning {
            border-left-color: #ffc107;
            background: linear-gradient(135deg, #fffdf7 0%, #ffffff 100%);
        }
        
        .metric-value {
            font-size: 2.2rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .metric-label {
            font-size: 0.95rem;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            font-weight: 500;
        }
        
        .metric-change {
            font-size: 0.9rem;
            font-weight: 600;
            margin-top: 8px;
            padding: 4px 8px;
            border-radius: 12px;
            display: inline-block;
        }
        
        .metric-change.increase {
            background: rgba(220, 53, 69, 0.1);
            color: #dc3545;
        }
        
        .controls-toolbar {
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
            color: white;
            padding: 18px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 3px solid #1abc9c;
        }
        
        .scenario-controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .scenario-btn {
            background: rgba(255,255,255,0.15);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }
        
        .scenario-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.1);
            transition: left 0.3s ease;
        }
        
        .scenario-btn:hover::before,
        .scenario-btn.active::before {
            left: 0;
        }
        
        .scenario-btn:hover,
        .scenario-btn.active {
            background: #1abc9c;
            border-color: #1abc9c;
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(26, 188, 156, 0.4);
        }
        
        .animation-controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .time-display {
            background: rgba(0,0,0,0.4);
            padding: 8px 16px;
            border-radius: 20px;
            font-family: 'Courier New', monospace;
            font-weight: 600;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .route-stats {
            background: white;
            border-radius: 12px;
            padding: 18px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }
        
        .route-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }
        
        .route-option {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #007bff;
            text-align: center;
        }
        
        .route-option.alternative {
            border-left-color: #dc3545;
        }
        
        .port-congestion {
            background: white;
            border-radius: 12px;
            padding: 18px;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }
        
        .port-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border-left: 4px solid #28a745;
        }
        
        .port-item.congested {
            border-left-color: #dc3545;
            background: linear-gradient(135deg, #fff8f8 0%, #ffffff 100%);
        }
        
        .port-item.warning {
            border-left-color: #ffc107;
            background: linear-gradient(135deg, #fffdf7 0%, #ffffff 100%);
        }
        
        .vessel-marker {
            animation: vesselMove 3s ease-in-out infinite;
        }
        
        @keyframes vesselMove {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            backdrop-filter: blur(5px);
        }
        
        .loading-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }
        
        .spinner-wave {
            display: inline-block;
            width: 40px;
            height: 40px;
            margin-bottom: 15px;
        }
        
        .spinner-wave div {
            display: inline-block;
            width: 4px;
            height: 20px;
            background: #3498db;
            margin: 0 2px;
            animation: wave 1.2s infinite ease-in-out;
        }
        
        .spinner-wave div:nth-child(2) { animation-delay: -1.1s; }
        .spinner-wave div:nth-child(3) { animation-delay: -1.0s; }
        .spinner-wave div:nth-child(4) { animation-delay: -0.9s; }
        .spinner-wave div:nth-child(5) { animation-delay: -0.8s; }
        
        @keyframes wave {
            0%, 40%, 100% { transform: scaleY(0.4); }
            20% { transform: scaleY(1.0); }
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <div class="demo-header">
            <h1>⚓ Panama Canal Crisis: Enhanced Maritime Routes</h1>
            <div class="subtitle">Real-Time Global Shipping Impact Analysis with Detailed Route Visualization</div>
        </div>
        
        <div class="crisis-banner">
            <strong>⚠️ MARITIME EMERGENCY:</strong> Panama Canal indefinitely closed - 14,500+ vessels seeking alternative routes - $200M+ daily impact
        </div>
        
        <div class="controls-toolbar">
            <div class="scenario-controls">
                <span style="margin-right: 15px; font-weight: 600;">Analysis Mode:</span>
                <button class="scenario-btn active" onclick="loadScenario('crisis')">Crisis Impact</button>
                <button class="scenario-btn" onclick="loadScenario('normal')">Normal Operations</button>
                <button class="scenario-btn" onclick="loadScenario('alternatives')">Route Alternatives</button>
            </div>
            
            <div class="animation-controls">
                <button class="scenario-btn" onclick="animateTrafficFlow()">🎬 Animate Traffic</button>
                <button class="scenario-btn" onclick="showRouteComparison()">📊 Compare Routes</button>
                <div class="time-display" id="current-timestamp">Crisis Day 1 - 08:00 UTC</div>
            </div>
        </div>
        
        <div class="main-layout">
            <div class="map-section">
                <div id="maritime-map"></div>
                
                <div class="route-info-panel">
                    <h6><strong>🛳️ Active Maritime Routes</strong></h6>
                    <div class="legend-item">
                        <div class="legend-line" style="background: #28a745;"></div>
                        <span><strong>Normal Panama Route</strong><br><small>8,847 nm • 21 days • $340K</small></span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-line animated" style="background: #dc3545;"></div>
                        <span><strong>Cape of Good Hope</strong><br><small>21,694 nm • 39 days • $1.19M</small></span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-line animated" style="background: #ff6b6b;"></div>
                        <span><strong>Cape Horn Route</strong><br><small>19,892 nm • 37 days • $1.08M</small></span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-line animated" style="background: #17a2b8;"></div>
                        <span><strong>Suez Canal (Congested)</strong><br><small>12,285 nm • 35 days • $687K</small></span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-line" style="background: #ffc107;"></div>
                        <span><strong>Trans-Pacific Alt</strong><br><small>15,632 nm • 35 days • $942K</small></span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-line" style="background: #6f42c1;"></div>
                        <span><strong>Arctic Route (Summer)</strong><br><small>11,200 nm • 28 days • $520K</small></span>
                    </div>
                </div>
                
                <div class="loading-overlay" id="loading-overlay">
                    <div class="loading-content">
                        <div class="spinner-wave">
                            <div></div><div></div><div></div><div></div><div></div>
                        </div>
                        <h5>Calculating Maritime Routes</h5>
                        <p id="loading-message">Analyzing vessel movements and port congestion...</p>
                    </div>
                </div>
            </div>
            
            <div class="analytics-sidebar">
                <div class="impact-alert">
                    <h6><strong>Global Supply Chain Impact</strong></h6>
                    <p><strong>14,500+ vessels</strong> diverted to alternative routes<br>
                    <strong>89 major ports</strong> experiencing severe congestion<br>
                    <strong>$200M+ daily</strong> additional operational costs</p>
                </div>
                
                <div class="metric-card critical">
                    <div class="metric-value">+18.2 days</div>
                    <div class="metric-label">Average Transit Delay</div>
                    <div class="metric-change increase">+430% vs normal operations</div>
                </div>
                
                <div class="metric-card critical">
                    <div class="metric-value">+$847K</div>
                    <div class="metric-label">Additional Cost per Vessel</div>
                    <div class="metric-change increase">+249% operational cost increase</div>
                </div>
                
                <div class="metric-card warning">
                    <div class="metric-value">12,847 nm</div>
                    <div class="metric-label">Additional Distance</div>
                    <div class="metric-change increase">+145% route extension average</div>
                </div>
                
                <div class="metric-card critical">
                    <div class="metric-value">2.8M TEU</div>
                    <div class="metric-label">Cargo Capacity Affected</div>
                    <div class="metric-change increase">67% of Pacific-Atlantic trade</div>
                </div>
                
                <div class="route-stats">
                    <h6><strong>📈 Route Performance Analysis</strong></h6>
                    <canvas id="route-performance-chart" width="350" height="200"></canvas>
                </div>
                
                <div class="port-congestion">
                    <h6><strong>🏭 Port Congestion Status</strong></h6>
                    <div id="port-status-list">
                        <div class="port-item congested">
                            <div>
                                <strong>Los Angeles/Long Beach</strong><br>
                                <small>342% volume increase</small>
                            </div>
                            <span style="color: #dc3545; font-weight: bold;">CRITICAL</span>
                        </div>
                        <div class="port-item congested">
                            <div>
                                <strong>Rotterdam</strong><br>
                                <small>298% volume increase</small>
                            </div>
                            <span style="color: #dc3545; font-weight: bold;">CRITICAL</span>
                        </div>
                        <div class="port-item warning">
                            <div>
                                <strong>Singapore</strong><br>
                                <small>276% volume increase</small>
                            </div>
                            <span style="color: #ffc107; font-weight: bold;">HIGH</span>
                        </div>
                        <div class="port-item congested">
                            <div>
                                <strong>Suez Canal</strong><br>
                                <small>423% traffic increase</small>
                            </div>
                            <span style="color: #dc3545; font-weight: bold;">EXTREME</span>
                        </div>
                    </div>
                </div>
                
                <div class="route-stats">
                    <h6><strong>⏱️ Delay Timeline</strong></h6>
                    <canvas id="delay-timeline-chart" width="350" height="150"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        let map;
        let routeLayers = [];
        let vesselMarkers = [];
        let portMarkers = [];
        let currentScenario = 'crisis';
        let animationInterval;
        
        // Detailed maritime route coordinates with realistic waypoints
        const detailedRoutes = {
            // Normal Panama Canal route (Asia to US East Coast)
            normalPanama: {
                name: "Normal Panama Route",
                path: [
                    [31.2304, 121.4737],  // Shanghai
                    [22.3964, 114.1095], // Hong Kong
                    [1.3521, 103.8198],  // Singapore
                    [6.2088, 106.8456],  // Jakarta
                    [8.9824, -79.5199],  // Panama Canal Pacific
                    [9.0796, -79.6034],  // Panama Canal
                    [9.1951, -79.7048],  // Panama Canal Atlantic
                    [25.7617, -80.1918], // Miami
                    [40.6643, -74.0126]  // New York
                ],
                color: "#28a745",
                weight: 4,
                distance: 8847,
                time: 21,
                cost: 340000,
                status: "blocked"
            },
            
            // Cape of Good Hope alternative (Asia to Europe/US East)
            capeRoute: {
                name: "Cape of Good Hope Route",
                path: [
                    [31.2304, 121.4737],  // Shanghai
                    [22.3964, 114.1095], // Hong Kong
                    [1.3521, 103.8198],  // Singapore
                    [-6.2088, 106.8456], // Jakarta
                    [-25.9269, 32.5841], // Maputo
                    [-33.9249, 18.4241], // Cape Town
                    [-15.4167, 28.2833], // Luanda
                    [6.6505, 3.3101],    // Lagos
                    [36.8065, -5.3115],  // Gibraltar
                    [51.9244, 4.4777],   // Rotterdam
                    [40.6643, -74.0126]  // New York (via Atlantic)
                ],
                color: "#dc3545",
                weight: 5,
                distance: 21694,
                time: 39,
                cost: 1187000,
                status: "active",
                dashArray: "10, 5"
            },
            
            // Cape Horn alternative (Asia to US East via Pacific)
            capeHornRoute: {
                name: "Cape Horn Route",
                path: [
                    [31.2304, 121.4737],  // Shanghai
                    [35.6762, 139.6503], // Tokyo
                    [21.3099, -157.8581], // Honolulu
                    [33.7701, -118.1937], // Los Angeles
                    [-12.0464, -77.0428], // Lima
                    [-33.4489, -70.6693], // Santiago
                    [-54.8019, -68.3030], // Cape Horn
                    [-34.6037, -58.3816], // Buenos Aires
                    [40.6643, -74.0126]   // New York
                ],
                color: "#ff6b6b",
                weight: 4,
                distance: 19892,
                time: 37,
                cost: 1087000,
                status: "active",
                dashArray: "15, 10"
            },
            
            // Suez Canal route (congested)
            suezRoute: {
                name: "Suez Canal Route (Congested)",
                path: [
                    [31.2304, 121.4737],  // Shanghai
                    [1.3521, 103.8198],  // Singapore
                    [19.0760, 72.8777],  // Mumbai
                    [25.2048, 55.2708],  // Dubai
                    [26.3351, 50.0990],  // Bahrain
                    [30.0626, 32.3498],  // Suez Canal
                    [31.2001, 29.9187],  // Alexandria
                    [36.8065, -5.3115],  // Gibraltar
                    [51.9244, 4.4777],   // Rotterdam
                    [40.6643, -74.0126]  // New York
                ],
                color: "#17a2b8",
                weight: 6,
                distance: 12285,
                time: 35,
                cost: 687000,
                status: "congested",
                dashArray: "5, 5"
            },
            
            // Trans-Pacific alternative
            transPacificRoute: {
                name: "Trans-Pacific Route",
                path: [
                    [31.2304, 121.4737],  // Shanghai
                    [35.6762, 139.6503], // Tokyo
                    [37.7749, -122.4194], // San Francisco
                    [33.7701, -118.1937], // Los Angeles
                    [29.7604, -95.3698],  // Houston
                    [25.7617, -80.1918], // Miami
                    [40.6643, -74.0126]   // New York
                ],
                color: "#ffc107",
                weight: 4,
                distance: 15632,
                time: 35,
                cost: 942000,
                status: "active"
            },
            
            // Arctic route (seasonal)
            arcticRoute: {
                name: "Northern Sea Route (Arctic)",
                path: [
                    [31.2304, 121.4737],  // Shanghai
                    [59.9311, 30.3609],  // St. Petersburg
                    [69.6492, 18.9553],  // Tromsø
                    [78.9167, 11.9500],  // Svalbard
                    [71.0486, -8.0751],  // Reykjavik
                    [51.9244, 4.4777],   // Rotterdam
                    [40.6643, -74.0126]  // New York
                ],
                color: "#6f42c1",
                weight: 4,
                distance: 11200,
                time: 28,
                cost: 520000,
                status: "seasonal",
                dashArray: "20, 10"
            }
        };
        
        // Major ports with realistic coordinates and current status
        const majorPorts = {
            // Blocked/Affected
            panama: {
                coords: [9.0796, -79.6034],
                name: "Panama Canal",
                status: "blocked",
                icon: "🚫",
                color: "#dc3545",
                info: "CLOSED - Extreme drought conditions"
            },
            
            // Severely Congested
            losAngeles: {
                coords: [33.7701, -118.1937],
                name: "Los Angeles",
                status: "critical",
                icon: "🔴",
                color: "#dc3545",
                info: "CRITICAL - 342% volume increase, 23 days delay"
            },
            longBeach: {
                coords: [33.7675, -118.1892],
                name: "Long Beach",
                status: "critical",
                icon: "🔴",
                color: "#dc3545",
                info: "CRITICAL - 412% volume increase, 28 days delay"
            },
            rotterdam: {
                coords: [51.9244, 4.4777],
                name: "Rotterdam",
                status: "critical",
                icon: "🔴",
                color: "#dc3545",
                info: "CRITICAL - 298% volume increase, 19 days delay"
            },
            
            // High Congestion
            singapore: {
                coords: [1.3521, 103.8198],
                name: "Singapore",
                status: "high",
                icon: "🟡",
                color: "#ffc107",
                info: "HIGH - 276% volume increase, 16 days delay"
            },
            suez: {
                coords: [30.0626, 32.3498],
                name: "Suez Canal",
                status: "extreme",
                icon: "🔴",
                color: "#8b0000",
                info: "EXTREME - 423% traffic increase, 14 days delay"
            },
            
            // Alternative routes
            capeTown: {
                coords: [-33.9249, 18.4241],
                name: "Cape Town",
                status: "busy",
                icon: "🟠",
                color: "#fd7e14",
                info: "BUSY - Alternative route hub, increased traffic"
            }
        };
        
        function initializeMap() {
            // Initialize map with ocean-focused view
            map = L.map('maritime-map', {
                center: [20, -30],
                zoom: 2.2,
                zoomControl: true,
                attributionControl: false,
                preferCanvas: true
            });
            
            // Add maritime-themed basemap
            L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/Ocean/World_Ocean_Base/MapServer/tile/{z}/{y}/{x}', {
                attribution: 'Esri, DeLorme, NAVTEQ',
                maxZoom: 16
            }).addTo(map);
            
            // Add shipping lanes overlay
            L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/Ocean/World_Ocean_Reference/MapServer/tile/{z}/{y}/{x}', {
                attribution: 'Esri, DeLorme, NAVTEQ',
                maxZoom: 16,
                opacity: 0.5
            }).addTo(map);
            
            // Initialize ports and routes
            addPortMarkers();
            loadScenario('crisis');
            initializeCharts();
            
            console.log('🌊 Enhanced maritime routes visualization initialized');
        }
        
        function addPortMarkers() {
            Object.entries(majorPorts).forEach(([key, port]) => {
                const markerHtml = `
                    <div style="
                        background: ${port.color}; 
                        width: 24px; 
                        height: 24px; 
                        border-radius: 50%; 
                        border: 3px solid white; 
                        display: flex; 
                        align-items: center; 
                        justify-content: center; 
                        font-size: 12px;
                        box-shadow: 0 2px 8px rgba(0,0,0,0.3);
                    ">${port.icon}</div>
                `;
                
                const icon = L.divIcon({
                    html: markerHtml,
                    className: 'port-marker',
                    iconSize: [24, 24]
                });
                
                const marker = L.marker(port.coords, { icon }).addTo(map);
                marker.bindPopup(`
                    <div style="text-align: center; min-width: 200px;">
                        <h6><strong>${port.name}</strong></h6>
                        <p style="margin: 8px 0; color: ${port.color}; font-weight: bold;">
                            ${port.status.toUpperCase()}
                        </p>
                        <p style="margin: 0; font-size: 0.9em;">
                            ${port.info}
                        </p>
                    </div>
                `);
                
                portMarkers.push(marker);
            });
        }
        
        function loadScenario(scenario) {
            currentScenario = scenario;
            
            // Update active button
            document.querySelectorAll('.scenario-btn').forEach(btn => btn.classList.remove('active'));
            event?.target?.classList.add('active');
            
            // Clear existing routes
            routeLayers.forEach(layer => map.removeLayer(layer));
            routeLayers = [];
            
            // Show loading
            showLoading('Loading maritime route data...');
            
            setTimeout(() => {
                switch(scenario) {
                    case 'normal':
                        loadNormalOperations();
                        break;
                    case 'crisis':
                        loadCrisisRoutes();
                        break;
                    case 'alternatives':
                        loadAlternativeRoutes();
                        break;
                }
                hideLoading();
            }, 1500);
        }
        
        function loadNormalOperations() {
            // Show only normal routes
            const route = detailedRoutes.normalPanama;
            const polyline = L.polyline(route.path, {
                color: route.color,
                weight: route.weight,
                opacity: 0.8
            }).addTo(map);
            
            polyline.bindPopup(`
                <strong>${route.name}</strong><br>
                Distance: ${route.distance.toLocaleString()} nm<br>
                Transit Time: ${route.time} days<br>
                Cost: $${route.cost.toLocaleString()}<br>
                Status: <span style="color: #28a745;">NORMAL</span>
            `);
            
            routeLayers.push(polyline);
            
            document.getElementById('current-timestamp').textContent = 'Normal Operations - All Routes Clear';
        }
        
        function loadCrisisRoutes() {
            // Show Panama as blocked and alternative routes as active
            const activeRoutes = ['capeRoute', 'suezRoute', 'transPacificRoute'];
            
            // Add blocked Panama route (grayed out)
            const panamaRoute = detailedRoutes.normalPanama;
            const blockedRoute = L.polyline(panamaRoute.path, {
                color: '#6c757d',
                weight: 3,
                opacity: 0.4,
                dashArray: '10, 10'
            }).addTo(map);
            
            blockedRoute.bindPopup(`
                <strong>${panamaRoute.name} - BLOCKED</strong><br>
                Status: <span style="color: #dc3545;">CLOSED</span><br>
                Reason: Extreme drought conditions<br>
                Impact: 14,500+ vessels affected
            `);
            
            routeLayers.push(blockedRoute);
            
            // Add active alternative routes
            activeRoutes.forEach(routeKey => {
                const route = detailedRoutes[routeKey];
                const polyline = L.polyline(route.path, {
                    color: route.color,
                    weight: route.weight,
                    opacity: 0.9,
                    dashArray: route.dashArray || null
                }).addTo(map);
                
                // Add directional arrows for active routes
                const decorator = L.polylineDecorator(polyline, {
                    patterns: [{
                        offset: '5%',
                        repeat: '10%',
                        symbol: L.Symbol.arrowHead({
                            pixelSize: 8,
                            headAngle: 60,
                            fillColor: route.color,
                            color: route.color
                        })
                    }]
                });
                
                decorator.addTo(map);
                routeLayers.push(decorator);
                
                polyline.bindPopup(`
                    <strong>${route.name}</strong><br>
                    Distance: ${route.distance.toLocaleString()} nm<br>
                    Transit Time: ${route.time} days<br>
                    Cost: $${route.cost.toLocaleString()}<br>
                    Status: <span style="color: ${route.color};">${route.status.toUpperCase()}</span>
                `);
                
                routeLayers.push(polyline);
            });
            
            document.getElementById('current-timestamp').textContent = 'Crisis Day 3 - 14:30 UTC';
        }
        
        function loadAlternativeRoutes() {
            // Show all alternative routes including seasonal ones
            const alternativeRoutes = ['capeRoute', 'capeHornRoute', 'suezRoute', 'transPacificRoute', 'arcticRoute'];
            
            alternativeRoutes.forEach(routeKey => {
                const route = detailedRoutes[routeKey];
                const polyline = L.polyline(route.path, {
                    color: route.color,
                    weight: route.weight,
                    opacity: 0.8,
                    dashArray: route.dashArray || null
                }).addTo(map);
                
                polyline.bindPopup(`
                    <strong>${route.name}</strong><br>
                    Distance: ${route.distance.toLocaleString()} nm<br>
                    Transit Time: ${route.time} days<br>
                    Cost: $${route.cost.toLocaleString()}<br>
                    Viability: ${getRouteViability(route.status)}
                `);
                
                routeLayers.push(polyline);
            });
            
            document.getElementById('current-timestamp').textContent = 'Route Analysis - All Alternatives';
        }
        
        function getRouteViability(status) {
            switch(status) {
                case 'active': return '<span style="color: #28a745;">HIGH</span>';
                case 'congested': return '<span style="color: #ffc107;">MEDIUM</span>';
                case 'seasonal': return '<span style="color: #6f42c1;">SEASONAL</span>';
                case 'blocked': return '<span style="color: #dc3545;">BLOCKED</span>';
                default: return '<span style="color: #6c757d;">UNKNOWN</span>';
            }
        }
        
        function animateTrafficFlow() {
            showLoading('Animating vessel traffic flow...');
            
            // Clear existing vessel markers
            vesselMarkers.forEach(marker => map.removeLayer(marker));
            vesselMarkers = [];
            
            setTimeout(() => {
                // Add animated vessel markers along active routes
                const activeRoutes = ['capeRoute', 'suezRoute', 'transPacificRoute'];
                
                activeRoutes.forEach((routeKey, index) => {
                    const route = detailedRoutes[routeKey];
                    if (route.path.length > 2) {
                        // Add vessels at different points along the route
                        for (let i = 1; i < route.path.length - 1; i += 2) {
                            setTimeout(() => {
                                addVesselMarker(route.path[i], route.color, `Vessel on ${route.name}`);
                            }, index * 500 + i * 200);
                        }
                    }
                });
                
                hideLoading();
                
                // Update timestamp to show animation
                let animationDay = 1;
                animationInterval = setInterval(() => {
                    document.getElementById('current-timestamp').textContent = 
                        `Crisis Day ${animationDay} - Traffic Simulation`;
                    animationDay++;
                    
                    if (animationDay > 7) {
                        clearInterval(animationInterval);
                        document.getElementById('current-timestamp').textContent = 'Simulation Complete';
                    }
                }, 1000);
            }, 1000);
        }
        
        function addVesselMarker(coords, routeColor, name) {
            const vesselIcon = L.divIcon({
                html: `<div class="vessel-marker" style="
                    background: ${routeColor}; 
                    width: 12px; 
                    height: 12px; 
                    border-radius: 50%; 
                    border: 2px solid white;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
                "></div>`,
                className: 'vessel-marker-container',
                iconSize: [12, 12]
            });
            
            const vessel = L.marker(coords, { icon: vesselIcon }).addTo(map);
            vessel.bindPopup(`<strong>${name}</strong><br>Status: In Transit`);
            vesselMarkers.push(vessel);
        }
        
        function showRouteComparison() {
            showLoading('Generating route comparison analysis...');
            
            setTimeout(() => {
                // Update charts with detailed comparison
                updateChartsWithComparison();
                hideLoading();
            }, 1500);
        }
        
        function initializeCharts() {
            // Route Performance Chart
            const perfCtx = document.getElementById('route-performance-chart').getContext('2d');
            window.performanceChart = new Chart(perfCtx, {
                type: 'radar',
                data: {
                    labels: ['Speed', 'Cost', 'Reliability', 'Capacity', 'Weather Risk', 'Political Risk'],
                    datasets: [
                        {
                            label: 'Panama (Normal)',
                            data: [95, 95, 98, 100, 85, 90],
                            borderColor: '#28a745',
                            backgroundColor: 'rgba(40, 167, 69, 0.2)',
                            pointBackgroundColor: '#28a745'
                        },
                        {
                            label: 'Cape Route',
                            data: [45, 25, 70, 80, 60, 85],
                            borderColor: '#dc3545',
                            backgroundColor: 'rgba(220, 53, 69, 0.2)',
                            pointBackgroundColor: '#dc3545'
                        },
                        {
                            label: 'Suez (Congested)',
                            data: [30, 60, 40, 50, 75, 65],
                            borderColor: '#17a2b8',
                            backgroundColor: 'rgba(23, 162, 184, 0.2)',
                            pointBackgroundColor: '#17a2b8'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Route Performance Comparison'
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
            
            // Delay Timeline Chart
            const delayCtx = document.getElementById('delay-timeline-chart').getContext('2d');
            window.delayChart = new Chart(delayCtx, {
                type: 'line',
                data: {
                    labels: ['Day 1', 'Day 3', 'Day 7', 'Day 14', 'Day 21', 'Day 30'],
                    datasets: [{
                        label: 'Average Delay (days)',
                        data: [2, 8, 15, 18, 21, 23],
                        borderColor: '#dc3545',
                        backgroundColor: 'rgba(220, 53, 69, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#dc3545',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Delay Escalation Timeline'
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Days Delayed'
                            }
                        }
                    }
                }
            });
        }
        
        function updateChartsWithComparison() {
            // Update the performance chart with more detailed data
            if (window.performanceChart) {
                window.performanceChart.update();
            }
        }
        
        function showLoading(message = 'Loading...') {
            const overlay = document.getElementById('loading-overlay');
            const messageEl = document.getElementById('loading-message');
            messageEl.textContent = message;
            overlay.style.display = 'flex';
        }
        
        function hideLoading() {
            document.getElementById('loading-overlay').style.display = 'none';
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('⚓ Initializing Enhanced Maritime Routes Demo...');
            initializeMap();
            
            setTimeout(() => {
                console.log('🌊 Maritime crisis visualization ready with detailed routes');
            }, 1000);
        });
        
        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            if (animationInterval) {
                clearInterval(animationInterval);
            }
        });
    </script>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>