<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panama Canal Closure Impact Analysis - 4D Maritime Logistics</title>
    
    <!-- Leaflet for geographic visualization -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Chart.js for analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Bootstrap for styling -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Custom styling -->
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            margin: 0;
            padding: 15px;
        }
        
        .demo-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .demo-header {
            background: linear-gradient(135deg, #c62d42 0%, #8b0000 100%);
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        .demo-header h1 {
            margin: 0;
            font-size: 2.2rem;
            font-weight: 300;
        }
        
        .demo-header .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-top: 8px;
        }
        
        .crisis-alert {
            background: linear-gradient(135deg, #ff4757 0%, #ff3742 100%);
            color: white;
            padding: 15px;
            text-align: center;
            border-bottom: 3px solid #c0392b;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 0;
            height: 800px;
        }
        
        .map-container {
            position: relative;
            background: #e8f4fd;
        }
        
        #world-map {
            width: 100%;
            height: 100%;
        }
        
        .analytics-panel {
            background: #f8f9fa;
            border-left: 1px solid #dee2e6;
            padding: 20px;
            overflow-y: auto;
        }
        
        .metric-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid #007bff;
        }
        
        .metric-card.negative {
            border-left-color: #dc3545;
        }
        
        .metric-card.warning {
            border-left-color: #ffc107;
        }
        
        .metric-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .metric-label {
            font-size: 0.9rem;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .metric-change {
            font-size: 0.9rem;
            font-weight: 500;
            margin-top: 5px;
        }
        
        .metric-change.increase {
            color: #dc3545;
        }
        
        .metric-change.decrease {
            color: #28a745;
        }
        
        .route-legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.95);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            min-width: 200px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 3px;
            margin-right: 10px;
        }
        
        .controls-bar {
            background: #34495e;
            color: white;
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .scenario-selector {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .scenario-btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .scenario-btn:hover,
        .scenario-btn.active {
            background: #3498db;
            border-color: #3498db;
        }
        
        .time-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .time-display {
            background: rgba(0,0,0,0.3);
            padding: 5px 15px;
            border-radius: 15px;
            font-family: 'Courier New', monospace;
        }
        
        .chart-container {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .impact-summary {
            background: linear-gradient(135deg, #fff5f5 0%, #fed7d7 100%);
            border: 1px solid #fc8181;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .port-info {
            background: white;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 3px solid #3498db;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .loading-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 20px;
            border-radius: 8px;
            z-index: 2000;
            display: none;
        }
        
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <div class="demo-header">
            <h1>üö¢ Panama Canal Crisis Impact Analysis</h1>
            <div class="subtitle">4D Spatio-Temporal Maritime Logistics Analytics</div>
        </div>
        
        <div class="crisis-alert">
            <strong>‚ö†Ô∏è CRITICAL ALERT:</strong> Panama Canal closed due to extreme drought conditions - Global shipping routes affected
        </div>
        
        <div class="controls-bar">
            <div class="scenario-selector">
                <span>Scenario:</span>
                <button class="scenario-btn active" onclick="loadScenario('closure')">Canal Closure</button>
                <button class="scenario-btn" onclick="loadScenario('normal')">Normal Operations</button>
                <button class="scenario-btn" onclick="loadScenario('recovery')">Recovery Phase</button>
            </div>
            
            <div class="time-controls">
                <button class="scenario-btn" onclick="animateRoutes()">üé¨ Animate Impact</button>
                <div class="time-display" id="current-time">Day 1 - Canal Closure</div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="map-container">
                <div id="world-map"></div>
                <div class="route-legend">
                    <h6><strong>Shipping Routes</strong></h6>
                    <div class="legend-item">
                        <div class="legend-line" style="background: #28a745;"></div>
                        <span>Normal Panama Route</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-line" style="background: #dc3545;"></div>
                        <span>Alternative Routes</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-line" style="background: #ffc107;"></div>
                        <span>Congested Ports</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-line" style="background: #17a2b8;"></div>
                        <span>Suez Canal Route</span>
                    </div>
                </div>
                <div class="loading-indicator" id="loading">
                    <div class="spinner"></div>
                    Calculating route alternatives...
                </div>
            </div>
            
            <div class="analytics-panel">
                <div class="impact-summary">
                    <h6><strong>üö® Crisis Impact Summary</strong></h6>
                    <p><strong>14,500+ vessels</strong> affected globally<br>
                    <strong>$200M+ daily</strong> economic impact<br>
                    <strong>25 major ports</strong> experiencing congestion</p>
                </div>
                
                <div class="metric-card negative">
                    <div class="metric-value">+18.2 days</div>
                    <div class="metric-label">Average ETA Increase</div>
                    <div class="metric-change increase">+430% vs normal</div>
                </div>
                
                <div class="metric-card negative">
                    <div class="metric-value">+$847K</div>
                    <div class="metric-label">Additional Cost per Vessel</div>
                    <div class="metric-change increase">+65% fuel & port fees</div>
                </div>
                
                <div class="metric-card warning">
                    <div class="metric-value">12,847 nm</div>
                    <div class="metric-label">Additional Distance (Avg)</div>
                    <div class="metric-change increase">+245% route length</div>
                </div>
                
                <div class="metric-card negative">
                    <div class="metric-value">89%</div>
                    <div class="metric-label">Port Congestion Level</div>
                    <div class="metric-change increase">Critical threshold</div>
                </div>
                
                <div class="chart-container">
                    <canvas id="cost-impact-chart" width="300" height="200"></canvas>
                </div>
                
                <h6><strong>üè≠ Most Affected Ports</strong></h6>
                <div id="port-impacts">
                    <div class="port-info">
                        <strong>Los Angeles (USA)</strong><br>
                        <small>+342% container volume | 23 days avg delay</small>
                    </div>
                    <div class="port-info">
                        <strong>Rotterdam (Netherlands)</strong><br>
                        <small>+298% volume | 19 days avg delay</small>
                    </div>
                    <div class="port-info">
                        <strong>Singapore</strong><br>
                        <small>+276% volume | 16 days avg delay</small>
                    </div>
                    <div class="port-info">
                        <strong>Long Beach (USA)</strong><br>
                        <small>+412% volume | 28 days avg delay</small>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="route-comparison-chart" width="300" height="180"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        let map;
        let routeLines = [];
        let portMarkers = [];
        let vesselMarkers = [];
        let currentScenario = 'closure';
        
        // Geographic coordinates for key locations
        const locations = {
            panama_canal: [9.0796, -79.6034],
            suez_canal: [30.0626, 32.3498],
            los_angeles: [33.7701, -118.1937],
            rotterdam: [51.9244, 4.4777],
            singapore: [1.3521, 103.8198],
            shanghai: [31.2304, 121.4737],
            long_beach: [33.7675, -118.1892],
            new_york: [40.6643, -74.0126],
            hamburg: [53.5511, 9.9937],
            tokyo: [35.6167, 139.7406]
        };
        
        // Shipping routes data
        const routes = {
            normal: {
                asia_to_us_east: {
                    path: [locations.shanghai, locations.panama_canal, locations.new_york],
                    distance: 8847,
                    time: 21,
                    cost: 340000,
                    color: '#28a745'
                },
                asia_to_europe: {
                    path: [locations.singapore, locations.suez_canal, locations.rotterdam],
                    distance: 8285,
                    time: 19,
                    cost: 315000,
                    color: '#28a745'
                }
            },
            closure: {
                asia_to_us_east_alt1: {
                    path: [locations.shanghai, locations.singapore, locations.suez_canal, locations.rotterdam, locations.new_york],
                    distance: 21694,
                    time: 39,
                    cost: 1187000,
                    color: '#dc3545'
                },
                asia_to_us_east_alt2: {
                    path: [locations.tokyo, locations.los_angeles, locations.long_beach, locations.new_york],
                    distance: 15632,
                    time: 35,
                    cost: 942000,
                    color: '#dc3545'
                },
                asia_to_europe_congested: {
                    path: [locations.singapore, locations.suez_canal, locations.rotterdam],
                    distance: 8285,
                    time: 35,
                    cost: 687000,
                    color: '#ffc107'
                }
            }
        };
        
        // Port congestion data
        const portData = {
            normal: {
                'Los Angeles': { congestion: 15, delay: 2, volume_increase: 0 },
                'Rotterdam': { congestion: 12, delay: 1, volume_increase: 0 },
                'Singapore': { congestion: 18, delay: 2, volume_increase: 0 },
                'Long Beach': { congestion: 14, delay: 2, volume_increase: 0 }
            },
            closure: {
                'Los Angeles': { congestion: 89, delay: 23, volume_increase: 342 },
                'Rotterdam': { congestion: 76, delay: 19, volume_increase: 298 },
                'Singapore': { congestion: 82, delay: 16, volume_increase: 276 },
                'Long Beach': { congestion: 95, delay: 28, volume_increase: 412 }
            }
        };
        
        function initializeMap() {
            // Initialize Leaflet map
            map = L.map('world-map', {
                center: [20, 0],
                zoom: 2.5,
                zoomControl: true,
                attributionControl: false
            });
            
            // Add ocean-themed tile layer
            L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
                attribution: '¬©OpenStreetMap, ¬©CartoDB',
                subdomains: 'abcd',
                maxZoom: 19
            }).addTo(map);
            
            // Add key locations
            addLocationMarkers();
            
            // Load initial scenario
            loadScenario('closure');
            
            // Initialize charts
            initializeCharts();
            
            console.log('üåä Maritime logistics analysis initialized');
        }
        
        function addLocationMarkers() {
            // Panama Canal (closed)
            const panamaIcon = L.divIcon({
                html: '<div style="background: #dc3545; width: 20px; height: 20px; border-radius: 50%; border: 2px solid white; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 12px;">‚ùå</div>',
                className: 'custom-marker',
                iconSize: [24, 24]
            });
            
            L.marker(locations.panama_canal, { icon: panamaIcon })
                .bindPopup('<strong>Panama Canal - CLOSED</strong><br>Extreme drought conditions<br>Transit suspended indefinitely')
                .addTo(map);
            
            // Suez Canal (congested)
            const suezIcon = L.divIcon({
                html: '<div style="background: #ffc107; width: 18px; height: 18px; border-radius: 50%; border: 2px solid white; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 10px;">‚ö†Ô∏è</div>',
                className: 'custom-marker',
                iconSize: [22, 22]
            });
            
            L.marker(locations.suez_canal, { icon: suezIcon })
                .bindPopup('<strong>Suez Canal - CONGESTED</strong><br>+400% traffic increase<br>14-day average delays')
                .addTo(map);
            
            // Major ports with congestion indicators
            const ports = [
                { name: 'Los Angeles', coords: locations.los_angeles, congestion: 'critical' },
                { name: 'Rotterdam', coords: locations.rotterdam, congestion: 'high' },
                { name: 'Singapore', coords: locations.singapore, congestion: 'high' },
                { name: 'Long Beach', coords: locations.long_beach, congestion: 'critical' }
            ];
            
            ports.forEach(port => {
                const color = port.congestion === 'critical' ? '#dc3545' : '#ffc107';
                const portIcon = L.divIcon({
                    html: `<div style="background: ${color}; width: 14px; height: 14px; border-radius: 50%; border: 2px solid white;"></div>`,
                    className: 'custom-marker',
                    iconSize: [18, 18]
                });
                
                const data = portData.closure[port.name];
                L.marker(port.coords, { icon: portIcon })
                    .bindPopup(`<strong>${port.name} Port</strong><br>Congestion: ${data.congestion}%<br>Avg Delay: ${data.delay} days<br>Volume: +${data.volume_increase}%`)
                    .addTo(map);
            });
        }
        
        function loadScenario(scenario) {
            currentScenario = scenario;
            
            // Update active button
            document.querySelectorAll('.scenario-btn').forEach(btn => btn.classList.remove('active'));
            event?.target?.classList.add('active');
            
            // Clear existing routes
            routeLines.forEach(line => map.removeLayer(line));
            routeLines = [];
            
            // Update time display
            const timeDisplay = document.getElementById('current-time');
            switch(scenario) {
                case 'normal':
                    timeDisplay.textContent = 'Normal Operations';
                    break;
                case 'closure':
                    timeDisplay.textContent = 'Day 1 - Canal Closure';
                    break;
                case 'recovery':
                    timeDisplay.textContent = 'Day 45 - Recovery Phase';
                    break;
            }
            
            // Load route data based on scenario
            const routeData = scenario === 'normal' ? routes.normal : routes.closure;
            
            Object.values(routeData).forEach(route => {
                const polyline = L.polyline(route.path, {
                    color: route.color,
                    weight: 4,
                    opacity: 0.8,
                    dashArray: route.color === '#ffc107' ? '10, 10' : null
                }).addTo(map);
                
                polyline.bindPopup(`
                    <strong>Shipping Route</strong><br>
                    Distance: ${route.distance.toLocaleString()} nautical miles<br>
                    Transit Time: ${route.time} days<br>
                    Cost: $${route.cost.toLocaleString()}
                `);
                
                routeLines.push(polyline);
            });
            
            // Update analytics
            updateAnalytics(scenario);
            
            // Show loading indicator briefly
            showLoading();
        }
        
        function animateRoutes() {
            showLoading('Simulating vessel movements...');
            
            // Animate route changes over time
            let day = 1;
            const maxDays = 7;
            
            const animationInterval = setInterval(() => {
                document.getElementById('current-time').textContent = `Day ${day} - Impact Analysis`;
                
                // Add vessel markers along routes
                if (day <= 3) {
                    addVesselMovement();
                }
                
                // Update congestion levels
                updateCongestionAnimation(day);
                
                day++;
                
                if (day > maxDays) {
                    clearInterval(animationInterval);
                    document.getElementById('current-time').textContent = 'Day 7 - Full Impact';
                    hideLoading();
                }
            }, 1500);
        }
        
        function addVesselMovement() {
            const vesselIcon = L.divIcon({
                html: '<div style="background: #007bff; width: 8px; height: 8px; border-radius: 50%; border: 1px solid white;"></div>',
                className: 'vessel-marker',
                iconSize: [10, 10]
            });
            
            // Add vessels on alternative routes
            const altRoutes = routes.closure;
            Object.values(altRoutes).forEach(route => {
                if (route.path.length > 2) {
                    const midPoint = route.path[Math.floor(route.path.length / 2)];
                    const vessel = L.marker(midPoint, { icon: vesselIcon }).addTo(map);
                    vesselMarkers.push(vessel);
                }
            });
        }
        
        function updateCongestionAnimation(day) {
            const intensity = Math.min(day * 15, 100);
            
            // Update port congestion visualization
            // This would animate the port marker sizes/colors based on congestion levels
        }
        
        function updateAnalytics(scenario) {
            if (scenario === 'closure') {
                // Update metrics for closure scenario
                document.querySelector('.metric-card:nth-child(1) .metric-value').textContent = '+18.2 days';
                document.querySelector('.metric-card:nth-child(2) .metric-value').textContent = '+$847K';
                document.querySelector('.metric-card:nth-child(3) .metric-value').textContent = '12,847 nm';
                document.querySelector('.metric-card:nth-child(4) .metric-value').textContent = '89%';
            } else if (scenario === 'normal') {
                // Normal operations metrics
                document.querySelector('.metric-card:nth-child(1) .metric-value').textContent = '21 days';
                document.querySelector('.metric-card:nth-child(2) .metric-value').textContent = '$340K';
                document.querySelector('.metric-card:nth-child(3) .metric-value').textContent = '8,847 nm';
                document.querySelector('.metric-card:nth-child(4) .metric-value').textContent = '15%';
            }
            
            // Update charts
            updateCharts(scenario);
        }
        
        function initializeCharts() {
            // Cost Impact Chart
            const costCtx = document.getElementById('cost-impact-chart').getContext('2d');
            window.costChart = new Chart(costCtx, {
                type: 'bar',
                data: {
                    labels: ['Normal', 'Via Suez', 'Around Cape', 'Trans-Pacific'],
                    datasets: [{
                        label: 'Cost ($000s)',
                        data: [340, 687, 1187, 942],
                        backgroundColor: ['#28a745', '#ffc107', '#dc3545', '#dc3545'],
                        borderColor: ['#1e7e34', '#e0a800', '#c82333', '#c82333'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Route Cost Comparison'
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Cost (USD thousands)'
                            }
                        }
                    }
                }
            });
            
            // Route Comparison Chart
            const routeCtx = document.getElementById('route-comparison-chart').getContext('2d');
            window.routeChart = new Chart(routeCtx, {
                type: 'line',
                data: {
                    labels: ['Day 1', 'Day 7', 'Day 14', 'Day 21', 'Day 30'],
                    datasets: [{
                        label: 'Average Delay (days)',
                        data: [2, 8, 15, 18, 23],
                        borderColor: '#dc3545',
                        backgroundColor: 'rgba(220, 53, 69, 0.1)',
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Delay Escalation Over Time'
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Days Delayed'
                            }
                        }
                    }
                }
            });
        }
        
        function updateCharts(scenario) {
            if (scenario === 'normal') {
                window.costChart.data.datasets[0].data = [340, 315, 0, 0];
                window.routeChart.data.datasets[0].data = [1, 1, 2, 2, 2];
            } else {
                window.costChart.data.datasets[0].data = [340, 687, 1187, 942];
                window.routeChart.data.datasets[0].data = [2, 8, 15, 18, 23];
            }
            
            window.costChart.update();
            window.routeChart.update();
        }
        
        function showLoading(message = 'Calculating route alternatives...') {
            const loading = document.getElementById('loading');
            loading.style.display = 'block';
            loading.querySelector('div:last-child').textContent = message;
            
            setTimeout(() => {
                hideLoading();
            }, 2000);
        }
        
        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üö¢ Initializing Panama Canal Impact Analysis...');
            initializeMap();
            
            setTimeout(() => {
                console.log('üåä 4D Maritime logistics visualization ready');
            }, 1000);
        });
    </script>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>